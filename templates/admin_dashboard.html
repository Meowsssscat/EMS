{% extends 'admin_layout.html' %}

{% block title %}TRANSCEND BPO - Dashboard{% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin_dashboard.css') }}">
{% endblock %}

{% block content %}
    <!-- Quick KPIs Section -->
    <div class="kpi-grid">
        <div class="kpi-card">
            <div class="kpi-icon">🧑‍🤝‍🧑</div>
            <div class="kpi-content">
                <div class="kpi-value" id="totalEmployees">{{ total_employees }}</div>
                <div class="kpi-label">Total Employees</div>
            </div>
        </div>

        <div class="kpi-card">
            <div class="kpi-icon">✅</div>
            <div class="kpi-content">
                <div class="kpi-value" id="attendanceToday">{{ attendance_today }}</div>
                <div class="kpi-label">Present Today</div>
            </div>
        </div>

        <div class="kpi-card">
            <div class="kpi-icon">📝</div>
            <div class="kpi-content">
                <div class="kpi-value" id="pendingRequests">{{ pending_leave_requests }}</div>
                <div class="kpi-label">Pending Leave Requests</div>
            </div>
        </div>

        <div class="kpi-card">
            <div class="kpi-icon">📊</div>
            <div class="kpi-content">
                <div class="kpi-value" id="attendanceRate">{{ overall_attendance_rate }}%</div>
                <div class="kpi-label">Overall Attendance Rate</div>
            </div>
        </div>
    </div>

    <!-- Main Analytics Section -->
    <div class="analytics-grid">
        <!-- Attendance Analytics -->
        <div class="analytics-card large">
            <div class="card-header">
                <h3 class="card-title">Attendance Trend</h3>
                <div class="card-subtitle">Daily attendance rates excluding weekends</div>
            </div>
            <div class="chart-container">
                <canvas id="attendanceChart"></canvas>
            </div>
        </div>

        <!-- Employee of the Month -->
        <div class="analytics-card">
            <div class="card-header">
                <h3 class="card-title">Employee of the Month</h3>
                <div class="card-subtitle">Highest attendance this month</div>
            </div>
            <div class="employee-spotlight">
                <div class="employee-avatar">👤</div>
                <div class="employee-info">
                    <div class="employee-name" id="employeeName">{{ employee_of_month.name }}</div>
                    <div class="employee-stat">
                        <span class="stat-value" id="employeePresentCount">{{ employee_of_month.present_count }}</span>
                        <span class="stat-label">Present Days</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Leave Analytics -->
        <div class="analytics-card large">
            <div class="card-header">
                <h3 class="card-title">Leave Requests Trend</h3>
                <div class="card-subtitle">Monthly leave request patterns</div>
            </div>
            <div class="chart-container">
                <canvas id="leaveChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Refresh Button -->
    <div class="refresh-section">
        <button id="refreshButton" class="refresh-btn">
            <span class="refresh-icon">↻</span>
            Refresh Data
        </button>
    </div>
</div>

<!-- Hidden data for JavaScript -->
<script type="application/json" id="dashboardData">
{
    "attendanceTrends": {{ attendance_trends | tojson }},
    "leaveTrends": {{ monthly_leave_trends | tojson }}
}
</script>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script src="{{ url_for('static', filename='js/admin_dashboard.js') }}"></script>
{% endblock %}