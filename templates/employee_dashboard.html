{% extends "employee_nav_footer_layout.html" %}
{% block extra_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/employee_dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="main-content">
    <div class="content-container">
        <!-- Welcome Hero Section -->
        <div class="welcome-hero">
            <div class="hero-content">
                <div class="welcome-text">
                    <h1 class="hero-title">Welcome back, {{ session.user_name.split()[0] if session.user_name else 'Employee' }}!</h1>
                    <p class="hero-subtitle">Here's your dashboard overview for today</p>
                    <div class="hero-meta">
                        <span class="current-date" id="currentDate"></span>
                        <span class="status-indicator online">
                            <span class="status-dot"></span>
                            Online
                        </span>
                    </div>
                </div>
                <div class="hero-actions">
                    <button class="hero-btn primary" onclick="clockInOut()" id="clockBtn">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12,6 12,12 16,14"/>
                        </svg>
                        {% if today_attendance and today_attendance.clock_in and not today_attendance.clock_out %}
                            Clock Out
                        {% elif today_attendance and today_attendance.clock_out %}
                            Completed
                        {% else %}
                            Clock In
                        {% endif %}
                    </button>
                </div> 
            </div>
        </div>

        <!-- Performance Metrics Grid -->
        {% if employee_stats %}
        <div class="metrics-section">
            <div class="section-header">
                <h2 class="section-title">Performance Overview</h2>
                <div class="section-meta">This Month</div>
            </div>
            <div class="metrics-grid">
                <div class="metric-card primary">
                    <div class="metric-header">
                        <div class="metric-icon attendance">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                            </svg>
                        </div>
                        {% if employee_stats.attendance_trend %}
                        <div class="metric-trend {{ 'positive' if employee_stats.attendance_trend > 0 else 'negative' if employee_stats.attendance_trend < 0 else 'neutral' }}">
                            <svg class="trend-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                {% if employee_stats.attendance_trend > 0 %}
                                <polyline points="23,6 13.5,15.5 8.5,10.5 1,18"/>
                                <polyline points="17,6 23,6 23,12"/>
                                {% elif employee_stats.attendance_trend < 0 %}
                                <polyline points="23,18 13.5,8.5 8.5,13.5 1,6"/>
                                <polyline points="17,18 23,18 23,12"/>
                                {% else %}
                                <line x1="5" y1="12" x2="19" y2="12"/>
                                {% endif %}
                            </svg>
                            {% if employee_stats.attendance_trend != 0 %}{{ "+" if employee_stats.attendance_trend > 0 else "" }}{{ employee_stats.attendance_trend }}%{% else %}0%{% endif %}
                        </div>
                        {% endif %}
                    </div>
                    <div class="metric-content">
                        <div class="metric-number">{{ "%.0f"|format(employee_stats.attendance_rate) }}%</div>
                        <div class="metric-label">Attendance Rate</div>
                        <div class="metric-subtitle">
                            {% if employee_stats.attendance_rate >= 95 %}Excellent performance
                            {% elif employee_stats.attendance_rate >= 85 %}Good performance
                            {% else %}Needs improvement{% endif %}
                        </div>
                    </div>
                </div>

                <div class="metric-card secondary">
                    <div class="metric-header">
                        <div class="metric-icon leave">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                <line x1="16" y1="2" x2="16" y2="6"/>
                                <line x1="8" y1="2" x2="8" y2="6"/>
                                <line x1="3" y1="10" x2="21" y2="10"/>
                            </svg>
                        </div>
                        <div class="metric-trend neutral">
                            <svg class="trend-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            {{ "%.0f"|format((employee_stats.leave_balance / employee_stats.total_leave_days * 100) if employee_stats.total_leave_days > 0 else 0) }}%
                        </div>
                    </div>
                    <div class="metric-content">
                        <div class="metric-number">{{ employee_stats.leave_balance }}</div>
                        <div class="metric-label">Leave Days Available</div>
                        <div class="metric-subtitle">Out of {{ employee_stats.total_leave_days }} days total</div>
                    </div>
                </div>

                <div class="metric-card warning">
                    <div class="metric-header">
                        <div class="metric-icon pending">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12,6 12,12 16,14"/>
                            </svg>
                        </div>
                        {% if employee_stats.pending_requests > 0 %}
                        <div class="metric-badge">{{ employee_stats.pending_requests }}</div>
                        {% endif %}
                    </div>
                    <div class="metric-content">
                        <div class="metric-number">{{ employee_stats.pending_requests }}</div>
                        <div class="metric-label">Pending Requests</div>
                        <div class="metric-subtitle">
                            {% if employee_stats.pending_requests == 0 %}All requests processed
                            {% else %}Awaiting approval{% endif %}
                        </div>
                    </div>
                </div>

                <div class="metric-card info">
                    <div class="metric-header">
                        <div class="metric-icon team">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M22 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
                            </svg>
                        </div>
                        <div class="department-badge">{{ employee.department if employee else 'Not Assigned' }}</div>
                    </div>
                    <div class="metric-content">
                        <div class="metric-number">{{ employee_stats.department_size }}</div>
                        <div class="metric-label">Team Members</div>
                        <div class="metric-subtitle">{{ employee.department if employee else 'Not Assigned' }} Department</div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Dashboard Content Grid -->
        <div class="dashboard-content">
            <!-- Quick Actions Panel -->
            <div class="dashboard-panel">
                <div class="panel-header">
                    <h3 class="panel-title">Quick Actions</h3>
                    
                </div>
                <div class="panel-body">
                    <div class="action-grid">
                        

                        <a href="{{ url_for('employee_leave.leave_requests') }}" class="action-card">
                            <div class="action-icon request">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14,2 14,8 20,8"/>
                                    <line x1="16" y1="13" x2="8" y2="13"/>
                                </svg>
                            </div>
                            <div class="action-details">
                                <div class="action-title">Request Leave</div>
                                <div class="action-desc">Submit new request</div>
                            </div>
                        </a>

                        <a href="{{ url_for('employee_attendance.attendance') }}" class="action-card">
                            <div class="action-icon schedule">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                    <line x1="16" y1="2" x2="16" y2="6"/>
                                    <line x1="8" y1="2" x2="8" y2="6"/>
                                    <line x1="3" y1="10" x2="21" y2="10"/>
                                </svg>
                            </div>
                            <div class="action-details">
                                <div class="action-title">View Attendance</div>
                                <div class="action-desc">Check attendance history</div>
                            </div>
                        </a>

                    </div>
                </div>
            </div>

            

            <!-- Recent Leave Requests Panel -->
            <div class="dashboard-panel">
                <div class="panel-header">
                    <h3 class="panel-title">Recent Leave Requests</h3>
                    <a href="{{ url_for('employee_leave.leave_requests') }}" class="panel-action primary">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="8" x2="12" y2="16"/>
                            <line x1="8" y1="12" x2="16" y2="12"/>
                        </svg>
                        New Request
                    </a>
                </div>
                <div class="panel-body">
                    <div class="activity-list">
                        {% if recent_leave_requests %}
                            {% for request in recent_leave_requests %}
                            <div class="activity-item">
                                <div class="activity-icon {{ request.status.lower() }}">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        {% if request.status == 'approved' %}
                                        <polyline points="20,6 9,17 4,12"/>
                                        {% elif request.status == 'rejected' %}
                                        <line x1="18" y1="6" x2="6" y2="18"/>
                                        <line x1="6" y1="6" x2="18" y2="18"/>
                                        {% else %}
                                        <circle cx="12" cy="12" r="10"/>
                                        <polyline points="12,6 12,12 16,14"/>
                                        {% endif %}
                                    </svg>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">{{ request.leave_type.name }}</div>
                                    <div class="activity-meta">
                                        {{ request.start_date.strftime('%b %d') }} - {{ request.end_date.strftime('%b %d, %Y') }}
                                        ({{ request.days }} day{{ 's' if request.days != 1 else '' }})
                                    </div>
                                </div>
                                <div class="activity-status {{ request.status.lower() }}">
                                    {{ request.status.title() }}
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                        <div class="no-data-message">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                            </svg>
                            <p>No recent leave requests</p>
                            <a href="{{ url_for('employee_leave.leave_requests') }}">Submit your first request</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Recent Notifications Panel -->

        </div>
    </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/employee_dashboard.js') }}"></script>
{% endblock %}